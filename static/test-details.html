<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script src="../../static/common.js"></script>
    <script src="../../static/lib/functional.js"></script>
    <script src="../../static/lib/to-function.js"></script>
    <script src="../../static/lib/js-class.js"></script>
    <script src="../../static/lib/excanvas.js"></script>
    <script src="../../static/lib/bluff-src.js"></script>
    <style>
        .removed {
            text-decoration: line-through
        }
        .fail {
            color: red;
        }
        .pass {
            color: green;
        }
    </style>
    <script>
    Functional.install()
    function removeResult(linkNode, rev, duration) {
        $.post('remove', {revision: rev, duration: duration}, function() {
            $(linkNode).parent().addClass('removed');
            $(linkNode).replaceWith("");
        });
    }
    $(document).ready(function() {
        $.getJSON('json', function(data) {
            var bestResult = data[0];
            var results = data[1];
            var durations = map(function(res){return res[1];}, results);
            var revisions = map(function(res){return res[0];}, results)
            drawGraph(durations.reverse(), revisions.reverse(), bestResult, 'timings');
            var lis = map(
                function(result) {
                    var passed = result[2];
                    return '<li class="$klass">revision: $rev, duration: $duration \
                        <a href="#" style="text-decoration: none" onclick="removeResult(this, \'$rev\', $duration)">(-)</a></li>'
                        .supplant({rev: result[0], duration: result[1], klass: passed && 'pass' || 'fail'});
                },
                results
            );
            $('#results').append(lis.join(''));
        });
    });
    </script>
</head>
<body>
    <a href="..">^ See all hosts that ran this test<a>
    <p>
    <canvas id='timings'></canvas>

    <h4>Test Results, newest first</h4>

    <ul id='results'>
    </ul>
</body>
</html>
